services:
  - docker
matrix:
  fast_finish: true

env:
  global:
    - secure: "U4onCmRz9xpGjr27VO/TqDU/Lu75rRcw/s9kINYiJpDxay/pRm5cy3ZVJqquE4j4EsoT3KRQwkqfw8bx145zAFrJ8QRVWqTC2/MoAgaqzpWArR+moV0V8iQ/uEa1bDAVTWwx/2CdHS64rxpVD7w32NzC1PeyEc4nlnVADktoUzsZg2yd2XMo2GEc/MC2v3Hr4IN7CZoWiBD2XKxSwbSFJY1wugg1GCLj8ztYjERmI0BUzhYlLviCZlRY5RaSut4rJG6otdDSjnsJ9RiNcXujcSEFSnPW3RnvgBkUIro8aMdCC9KWkqdTf8H8yJekKAjUI5pWkcR9FCClzcMq7pBAlxPWiWAC38ffStoEM9it7eUp2EVnd8SrrE8AqLG1x53p5fXmbhXEvORkfah20CdqZ1Ad7epDR+c/b7PKWispaO0nEDpDcwyofMpnvU99Q+4BSoHHigeVf+M0t+ieGIagECrnsZKfYvAuubrWxV8wBoT/MFni8nVrU4dev9tcFqz2Lrg/2x7w9CcgCKuG6yiHVYZYaFR0NdGgxxVcdWylc99p4BgLMyiY5saAxb/GgrwJkh2iv8i3WyTtoPbO6Yuqud78v4ZvkQOORUL5yH/GYQxdYiX90kGeAv+T1oe0i6mz3rJBaJPlVSz0/KnjOzbM4l3YQIMD6ujCgFbHpc3YY8k="
    - secure: "Xd6mcg4GmVwg80kKof1qJIgbYbL588FnglpgozS+UXziOT7ShRtF3auEj7etPuv8ZW+9ncynodEsHuV8iKuEkxtRhSccRqPGIfnusNLJ78yEG1jhAm7gBGeZLynLK17lTxZmlQNLH3e6/4cHJEK0xT1F2x17PYN79sNr6OzxxO3qDECOWv5RFHKVGLCeYbjrSVsCnIuHDV5Epn/baaLiAerNbh1k/bkaIFJfz0/ukwGGTaI0yy7/zCoHOYnN1rLa+24UNCNBmPGCXmy+n7W0RddL9/ybHWOJjXpmnDY8UxFepKFgtrECqb2TSSlStSMdGQLAijCFI1r70gFrZ7IHE7PdC4dT+sAkJAHY/M+7U9ai2nPqddl2/n6cdA20wn5Ia58lFPKuq7N6ILQX5F/UdjEEbJnRNfPORmfvJvxvSFW0GkbT6D9lx5ITqH16VwQpGHAhf26q1hAyu05MGEVcNMzvJYnX3H/5wFV5dUrsb7QVo3IPqkVSc9v2J58dj/PmVSaL91Oa8rtGLT2Bgcv79catEXVy6YVQfV06i/EAun1BX7/am6G2EMYncmVPoMOle2eHGN7sc7RiL5bd/GrHFvf+DiBDCvpDaGM9vfcPey26F8itJpmGUircCk4D4YUxiw/DWtmqbPKIR3a0c8VXxvzQfJbGzVdNr/NYafn2omc="
    # CONFIG_REPOSITORY
    - secure: "E8Ja+SxO4xIGokWQTs4gCprc1t2g/+mWVu4qH707oDjX0nGkv+wytaFmwpdn2xXF1//wE5wNSz8SdBxyTNMQmyZq+jwOHtPnUFXjfxe+dTT+dnwT+h1jXDWLh1rtsGtqJJsAi9D87GZY5cqtMtevuqydnTLLKOiBX5j+3N5gpsl2b6xfkHlhs+Gwjl4VacSHHkWVIuABMlJKL9bAzdueqsza2H98cr4My3eW3gkMDOeyhX9+rmaagHpegkwUig2VNB1Gy2oLz3KAzIpOUIdsliG98vZM9dGXAdQqfqtHhQ/94eUoyFqfm9lUVIPr10hLe1xzRGiZRBOidTPvLgtfJTTJ9YQZjVksKqGlOZA632gxYMEWc0ZsdecQrMNJtvtbEksiOO0dsYv7eSI3teL4qSn7OPHqSzW+xSXQxj80aJ5u7cs97OIAih3o6CJC4UQHjCUgrt5vJKd+0NHgBuLvVUwzai8O4eJD1wbGCRvUd4VEgz7DDHehXAj+EWzvRCYvo0JRnvc+jrW5jy/saHWcnnBW5kgjgE/uzSYZbUBYzurMbg6NjSc/knyhn2YHux5olANAKMog14aM3PL20QzkpHZsFlAaaXibz0HJB+A69FHVdZ+aEzn/5SBNLPmRYQcfRttjLVrd2UscLAsGlEVdPK+9NLow7rHqdjMDdvobEDY="
    # GITHUB_API_TOKEN
    - secure: "M9j47d/EaPr642sfC7JjD6a+I8x5CXF++qiXOgJIi09W1Q6pxJqAm4Jvh6hOjOmYWmP2KbH0GwVEgm5uAXUiPPWGIICNkBk0hebG3U0pg9J/ybuiPM82c1B0Ia8CHxnDq6QU74R9yCRHWoogar5oZwvVVgnXRbckgsyRbOghq2DDvw6JVgxIUG/HfhA7CLddqxu4lPa1CsfcsztH2He4/SsSBl9ywIs4yoDNTOEQWJWNJvfJuxIEPqA7WmBTm+g9xzKuhP0WHHNq63gGYWmXliUB8uwMNiL5UrDoycCA19QiKFLumX7RBGUdXE2T6TwousBgEjc3vf0Az2D6QRc9nL7cH9VYhG6J1wbpzS57cbjFqHZD53lJsTpGG+wqH+enodt0XnvHxzDtVNGXf0W+dUGGvZXN08wTEIoviNguenn287XGLSN2nO3+W/rOyUKUCqEt3kyepKAuVPa0gZKI+J4lP9qv1CceIR5drPfcB6eqU3UNIQCJPfabOg3hWNnwY0OkLfNMFHPOKozSjGX5hD87PsKDpOpTlhB4vwhRr+zx33QVPHOk1J4AEpiQNd8qAjYhuUEyUXDw1Mq6MK+BWck94zS4Gagumy76oYyZS66VaWj7TQJSAepglcnp+y8UCJ9NDB4quryQMoG8tkyGEMgnuks0YA2uw9g+4uIsFtI="
    # ARGOCD_AUTH_TOKEN
    - secure: "tRha0XbbzFZ4z5i+0jUIcVEXH99lHELjFWEe6FljpostEh8lw959vok/HLsduGMfLiYEoKeIwa3KCrXVJgWyuu9w3urgPwXpbovUV00n7eIgkAWx6qBhpVRW3MNWcla/DF63GnZ8Adn9VsD36NfXCOT3Wb71CgZZ+chVSlTjOZn9bS1eK1qn1RO+UxZ3WSOKjjjma4Oc50r22iysDMYhfJZGPIAY8pTimHqYVUgrfBg4ODcplUHUcK6byfoAjnXtvSL/j0/M/uQYZABjvJyKAkY8TfbAGT+bae9uhs5zh+Y+FZFajlbOiPbG3EP8L9REmZtTowyqrZxaz+QERFhwlapACRdZ/FV7jGNiFXVX3mTuS1yBG1GAuCG3/80VTM2f3BxsuZYJ/JxxYUD1a1urqQUFRNQfgzA8GvA6ViVrCQe7XsVhoTPAIcDC3opnQuJy7gV20XwCro4KjkJNg0Ha/fMKfazh6zK4e6fNXKPwgowHbjfRty59fAQDKQRQYSYIDzEUFYmd++nqQE1Rg/Kdkjb1HOB4GasDLDGwMRaOm5bUhf1gRrFKa+eqTukC/eV7/zzQdDjEchOU+e9TpM1rwkgHSdXEQt8RyZUju0CCSedKrTS/ssU7keFaLMHcRbzB9lL1Spr+sApyVBQBRa3QLztp6s6D3s7E9pPEP7LMjko="
    # SLACK_API_TOKEN
    - secure: "LPvyZ0RXAAvRgDY7XqbSqlnswBk0ET6ODtCeZZb/j+i0RR4tiOcF+mmAHkw5vWq1ko3jhjC3wVYcSbreJ+e5vKG8MUBjopqHt8Vy+pfeGbWDgPlc5e5DOKHQIJzhB9JUOmasaQDh7Vv3DnckHNuvlD3IZukMkNlvFlaBw20XUMdhvBFOeCpUDK1S3wKuCMRTmJlYpim4hUztjte35858bdQGHImTR+vIMNd8kyquuI2WZKx9xNzw3cqG7bHjQFVsPn3WTPcsJhnb6kMAbdDjzUUHmVme5DUQ3EClLHgM7DcreJ9d3btYk5ws/kevDepJSwwvTGY27vvgwADbFyOl+VlqYsyFBBgMH5NsawGddAVRG2R0BnVBDV1gMi/QxaCNMkN6BHzcBYsWs+6B7sKTUCcTWA4nDrKiMscYfi+A+X5+F4TTGqyIw00k30SvxVHSq0fPqMC/zvHphOglldBtqrOmIVOSya44oXXTFVhBmtSXl9CpMZass9G93+imm0r0Xx4UyiTXwXd9Nqk4JIY5N3AYXj3rBfrUQYrueDjO9I4SLxWXajcPBCwATnyAQKu8CMxhqk0pHWxip8V3Qcsz5c+QvVrUKGIQv25jhQm8PWRcOGgG2pTIgqjjoaxUtLbWRpqpf/zs2uCfjcfaPe/iyeMmYwajHMMHUX70+sV2Zw4="
    - APP_NAME=ttt-result-view
    - COMMIT=${TRAVIS_COMMIT::7}
    - IMAGE_NAME=tabletennistournament/result-view

script:
  # We do not have tests - why execute them? - npm run test-ci
  - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
  - export TAG=$(if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$BRANCH-$COMMIT"; fi | sed 's/\//-/')
  - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  - docker build . -t $IMAGE_NAME:latest
  - if [ $BRANCH = "master" ]; then docker tag $IMAGE_NAME:latest $IMAGE_NAME:master; fi
  - docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME:latest
  - if [ $BRANCH = "master" ]; then docker push $IMAGE_NAME:master; fi
  - docker push $IMAGE_NAME:$TAG
